---
layout:     post
title:      "合批优化"
subtitle:   " "
date:       2025-12-08 12:00:00
author:     "ALQ"
header-img: "img/post-bg-2015.jpg"
catalog: true
mathjax: true
tags:
    - cocos creator
    - 游戏开发
---

## 静态合批
静态：不能移动的物体
合批：同样的材质
不能移动的物体 同样的材质的物体，通过计算生成一个大物体，提交给GPU进行渲染。
优点：
1. 减少Draw Call次数
2. 减少GPU内存占用
缺点：
1. 物体移动时，需要重新计算大物体的顶点数据，导致性能下降。

### cocos中的api
`BatchingUtility.batchStaticModel(a,b)`
* 合批静态3D物体的api,把a节点下的所有静态3D物体合批到b节点下
* a：需要合批的物体数组
* b：合批后的物体

## 动态合批
在运行的时候，把相同材质的物体计算合成一个大物体，实时计算，
适用于动的物体，耗费cpu，合批物体的顶点数不要太多，cpu计算就会大，
动态合批提升10，顶点数太多计算耗费cpu，导致性能下降15，那么你的合批就是失败的

## GPU instacing
适用于影分身物体，同样的物体，cpu提交一个物体的mesh交给GPU，
gpu绘制出N个物体，这N个物体可以有不同的位置，旋转，缩放
cpu提交一个物体的mesh，这可以减轻cpu的负担
合批也能提升性能。
缺点：早期的GPU可能不支持，
补充：gpu Instacing只支持一种物体的合批，一个球和一个cube，相同的材质就不能合批

### cocos中使用GPU Instancing
![](/img/ALQ/2025-12-08-合批优化/2025-12-09-18-15-40.png)
