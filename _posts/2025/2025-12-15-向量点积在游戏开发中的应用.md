---
layout:     post
title:      "向量点积在游戏开发中的应用"
subtitle:   " "
date:       2025-12-15 12:00:00
author:     "ALQ"
header-img: "img/post-bg-2015.jpg"
catalog: true
mathjax: true
tags:
    - 游戏开发
---
## 点积的多层含义
1. $ a \cdot b = \vert a \vert \cdot \vert b \vert \cdot cos(θ) $
2. a 为(x1,y1), b 为(x2,y2),则点积结果为：$x1 \cdot x2 + y1 \cdot y2$
3. $a \cdot b = \vert a \vert \cdot \vert b \vert \cdot cos(θ) = \vert a \vert \cdot \vert b \vert \cdot \frac{a在b上的投影}{\vert a \vert} = a在b上的投影 \cdot \vert b \vert$
    - 当向量 b 取单位向量的时候，点积的结果就是向量 a 在向量 b 上的投影长度

## 向量点积的应用
### 计算夹角
这是点乘最常见的用途。通过点乘的反余弦（ acos ），可以求出两个向量的夹角。

- 公式 ：
    - $夹角 θ = acos( 点积 / ( \vert a \vert * \vert b \vert ) )$
- 范围 ：
    - 0° ≤ θ ≤ 180°
- 场景 ：判断敌人是否在玩家的扇形攻击范围内（如 60 度扇形）。
- 注意 ：在实际开发中，我们一般不用cos，因为cos(a) == cos(-a),所以cos的值不具有唯一性，使用cos后我们还得判断方向，所以实际开发中，我们一般使用atan2(y,x)，它的正负号可以判断方向，范围为[-π,π]，可以直接用于计算夹角，一步到位。
- 使用atan2计算：

```typescript
/**
 * 计算两个向量之间的角度
 * @param v1 向量1
 * @param v2 向量2
 * @returns 角度
 */
export function getAngleBetweenVectors(v1: { x: number, y: number }, v2: { x: number, y: number }) {
  const dot = v1.x * v2.x + v1.y * v2.y; // 计算点积，点积为v1在v2上的投影长度，可以代表x分量
  const cross = v1.x * v2.y - v1.y * v2.x; //计算叉积，叉积为v1在v2的法线上的投影长度，可以代表y分量
  const mag1 = Math.sqrt(v1.x * v1.x + v1.y * v1.y);
  const mag2 = Math.sqrt(v2.x * v2.x + v2.y * v2.y);
  if (mag1 <= 1e-8 || mag2 <= 1e-8) return 0;
  const angle = Math.atan2(Math.abs(cross), dot); // atan2(y,x)
  return angle * 180 / Math.PI; // 将弧度转换为角度
}
```

### 判断前后关系
不需要计算具体角度，仅通过点乘的正负号即可判断方向。
- 公式 ：
    - $点积 = a \cdot b = \vert a \vert * \vert b \vert * cos(θ)$
        - 当 $a$ 和 $b$ 都取单位向量的时候，点积的结果就是 $cos(θ)$ 
- 判定规则 ：
    - $cos(θ)$ 结果 > 0 ：夹角 < 90°，目标在 前方 。
    - $cos(θ)$ 结果 < 0 ：夹角 > 90°，目标在 后方 。
    - $cos(θ)$ 结果 = 0 ：夹角 = 90°，目标 垂直 （侧面）,也可以说目标与自身在同一水平线上。
    - 为什么可以这样判定呢？我们可以想象自己面朝正前方站立，我们的方向是一条垂直于x轴的向量，当另一条向量和我们之间的夹角<90的时候，说明这条向量的终点一定是在我们前方的。。。

- 场景 ：
    - 背刺判定 ：判断玩家是否在怪物身后（玩家朝向与怪物朝向点乘 > 0）。
    - 赛车逆行 ：车头朝向与赛道方向点乘 < 0。

### 投影（碰撞检测与路径跟随）
- 公式 ：
    - $投影向量 = (a \cdot b) / \vert b \vert * b$
        - 当 $b$ 取单位向量的时候，投影向量的结果就是 $a \cdot b$
- 场景 ：
    - 分离轴定理 (SAT) ：用于检测多边形碰撞，将顶点投影到轴上比较重叠，详见[分离轴定理 (SAT)]。
    - 路径跟随 ：使角色沿着目标路径移动（角色位置向量与目标路径向量的投影向量方向移动）。

### 光照计算（图形渲染）
虽然这是图形学范畴，但在 Shader 编写中必不可少。

- 公式 ： Diffuse = max(0, dot(Normal, LightDir))
- 解释 ：表面法线 ( Normal ) 与光照方向 ( LightDir ) 的点乘决定了亮度。光线直射（夹角 0，点乘 1）最亮，侧射变暗，背光（点乘 < 0）全黑。
